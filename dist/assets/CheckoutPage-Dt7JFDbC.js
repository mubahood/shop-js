import{j as n,C as e,A as r,S as t,B as o,M as a}from"./vendor-bootstrap-5Pmslw1a.js";import{r as i}from"./vendor-react-CSr-5IoM.js";import{O as s}from"./OrderModel-BfrZ4kn4.js";import{q as d,v as l,T as m}from"./index-nWNd2qXB.js";import{f as c}from"./index-B8zPzRUh.js";import{O as u}from"./OrderModelUtils-Cp2Xs3Wd.js";import{D as p}from"./DynamicBreadcrumb-6LVadogf.js";import{u as h,a as x}from"./vendor-router-B5VXrYKF.js";import"./vendor-redux-DhM9Zidd.js";import"./vendor-query-BwsiJSmJ.js";const b=()=>{const b=h(),g=x(),{order:y}=g.state||{},{cartItems:v,getFormattedTotal:f,clearCart:k}=d();i.useEffect((()=>{y&&0!==v.length||b("/cart")}),[y,v.length,b]);const[j,w]=i.useState((()=>y&&"object"==typeof y?u.ensureOrderModel(y):new s)),[N,_]=i.useState(!1),[S,O]=i.useState(!1),[z,F]=i.useState(""),[I,C]=i.useState(!1),P=parseFloat(f().replace(/[^0-9.-]+/g,""))||0,T=parseFloat((null==j?void 0:j.delivery_amount)||"0")||0;parseFloat((null==j?void 0:j.payable_amount)||"0");const Y=P+T;i.useEffect((()=>{y&&0!==v.length?w((n=>{const e=u.ensureOrderModel(n);return e.order_total=P.toString(),e.payable_amount=(P+T).toString(),e})):b("/cart")}),[P,T,y,v.length,b]);return y&&0!==v.length?n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"\n  .checkout-page {\n    min-height: 100vh;\n    background: var(--background-body);\n    position: relative;\n  }\n\n  .checkout-card {\n    width: 100%;\n    min-height: 60vh;\n    background: var(--white);\n    border-radius: var(--border-radius);\n    box-shadow: var(--shadow-md);\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    padding: 0;\n    border: none;\n    transition: all 0.3s ease;\n  }\n\n  .checkout-card.loading {\n    pointer-events: none;\n    opacity: 0.7;\n  }\n\n  .checkout-header {\n    padding: 32px 32px 0 32px;\n    text-align: center;\n    background: none;\n    border: none;\n  }\n\n  .checkout-title {\n    font-size: 1.6rem;\n    font-weight: 700;\n    color: var(--text-color-dark);\n    margin-bottom: 0.25rem;\n  }\n\n  .checkout-subtitle {\n    font-size: 1rem;\n    color: var(--text-color-medium);\n    margin-bottom: 0;\n  }\n\n  .checkout-content {\n    padding: 32px;\n    background: none;\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n    justify-content: center;\n    position: relative;\n  }\n\n  .summary-item {\n    display: flex;\n    align-items: flex-start;\n    justify-content: space-between;\n    gap: 12px;\n    padding: 0;\n    background: none;\n    border: none;\n    animation: fadeInSlide 0.4s ease;\n  }\n\n  @keyframes fadeInSlide {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  .summary-item-content {\n    flex: 1;\n  }\n\n  .summary-item-title {\n    font-size: 1rem;\n    font-weight: 600;\n    color: var(--text-color-dark);\n    margin-bottom: 2px;\n  }\n\n  .summary-item-subtitle {\n    font-size: 0.92rem;\n    color: var(--text-color-medium);\n    margin-bottom: 0;\n  }\n\n  .summary-item-amount {\n    font-size: 1rem;\n    font-weight: 500;\n    color: var(--text-color-dark);\n    min-width: 90px;\n    text-align: right;\n  }\n\n  .summary-divider, .summary-divider-bold {\n    border: none;\n    height: 1px;\n    background: var(--border-color);\n    margin: 8px 0;\n    opacity: 0.5;\n  }\n\n  .summary-divider-bold {\n    height: 2px;\n    background: var(--primary-color);\n    opacity: 0.3;\n    margin: 16px 0;\n  }\n\n  .summary-total {\n    background: var(--background-light);\n    border-radius: var(--border-radius);\n    padding: 16px;\n    border: 2px solid var(--primary-color);\n    animation: pulseGlow 2s ease-in-out infinite;\n  }\n\n  @keyframes pulseGlow {\n    0%, 100% { box-shadow: 0 0 5px rgba(13, 110, 253, 0.2); }\n    50% { box-shadow: 0 0 15px rgba(13, 110, 253, 0.4); }\n  }\n\n  .summary-total-title {\n    font-size: 1.2rem;\n    font-weight: 700;\n    color: var(--primary-color);\n    margin-bottom: 0;\n  }\n\n  .summary-total-amount {\n    font-size: 1.2rem;\n    font-weight: 700;\n    color: var(--primary-color);\n    min-width: 90px;\n    text-align: right;\n  }\n\n  .checkout-error {\n    margin-top: 12px;\n    margin-bottom: 0;\n    text-align: center;\n    animation: shake 0.5s ease-in-out;\n  }\n\n  @keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n  }\n\n  .checkout-actions {\n    display: flex;\n    justify-content: center;\n    gap: 16px;\n    padding: 32px;\n    background: none;\n    border: none;\n    border-radius: 0 0 var(--border-radius) var(--border-radius);\n  }\n\n  .btn-back-checkout {\n    font-size: 1rem;\n    color: var(--primary-color);\n    background: var(--white);\n    border: 1px solid var(--primary-color);\n    border-radius: var(--border-radius);\n    min-width: 160px;\n    font-weight: 500;\n    transition: all 0.2s ease;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .btn-back-checkout:hover:not(:disabled) {\n    background: var(--primary-color);\n    color: var(--white);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);\n  }\n\n  .btn-back-checkout:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    pointer-events: none;\n  }\n\n  .btn-submit-order {\n    font-size: 1rem;\n    font-weight: 600;\n    border-radius: var(--border-radius);\n    background: var(--primary-color);\n    color: var(--white);\n    border: none;\n    min-width: 180px;\n    min-height: 42px;\n    transition: all 0.2s ease;\n    position: relative;\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .btn-submit-order:hover:not(:disabled) {\n    background: var(--primary-color-dark);\n    color: var(--white);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);\n  }\n\n  .btn-submit-order:disabled {\n    opacity: 0.7;\n    cursor: not-allowed;\n    pointer-events: none;\n  }\n\n  .btn-submit-order.loading {\n    pointer-events: none;\n  }\n\n  .loading-spinner {\n    width: 18px;\n    height: 18px;\n    margin-right: 8px;\n  }\n\n  .loading-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(6px);\n    z-index: 9999;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    animation: fadeInOverlay 0.3s ease;\n  }\n\n  @keyframes fadeInOverlay {\n    from { opacity: 0; }\n    to { opacity: 1; }\n  }\n\n  .loading-content {\n    background: white;\n    padding: 40px;\n    border-radius: 12px;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n    text-align: center;\n    min-width: 320px;\n    animation: slideInUp 0.3s ease;\n  }\n\n  @keyframes slideInUp {\n    from { opacity: 0; transform: translateY(30px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  .loading-spinner-large {\n    width: 50px;\n    height: 50px;\n    margin-bottom: 20px;\n    color: var(--primary-color);\n  }\n\n  .loading-text {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-color-dark);\n    margin-bottom: 8px;\n  }\n\n  .loading-subtext {\n    font-size: 1rem;\n    color: var(--text-color-medium);\n    margin: 0;\n  }\n\n  .modal-order-summary {\n    font-size: 1rem;\n    color: var(--primary-color);\n    margin-top: 12px;\n    margin-bottom: 12px;\n    text-align: center;\n    background: var(--background-light);\n    padding: 12px;\n    border-radius: var(--border-radius);\n    border: 1px solid var(--border-color);\n  }\n\n  .modal-content {\n    border-radius: 12px;\n    border: none;\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n  }\n\n  .modal-header {\n    border-bottom: 1px solid var(--border-color);\n    padding: 20px 24px;\n  }\n\n  .modal-body {\n    padding: 24px;\n  }\n\n  .modal-footer {\n    border-top: 1px solid var(--border-color);\n    padding: 20px 24px;\n  }\n\n  .modal-title {\n    font-weight: 600;\n    color: var(--text-color-dark);\n  }\n\n  @media (max-width: 575.98px) {\n    .checkout-card, .checkout-content, .checkout-header, .checkout-actions {\n      padding: 16px !important;\n    }\n    .checkout-title {\n      font-size: 1.3rem;\n    }\n    .summary-total-title, .summary-total-amount {\n      font-size: 1.1rem;\n    }\n    .checkout-actions {\n      flex-direction: column;\n    }\n    .btn-back-checkout, .btn-submit-order {\n      width: 100%;\n      min-width: auto;\n    }\n    .loading-content {\n      margin: 20px;\n      min-width: auto;\n      width: calc(100% - 40px);\n    }\n  }\n"}}),n.jsx(p,{showBackground:!0,showIcons:!0}),n.jsxs("div",{className:"checkout-page",children:[S&&n.jsx("div",{className:"loading-overlay",children:n.jsxs("div",{className:"loading-content",children:[n.jsx(t,{animation:"border",variant:"primary",className:"loading-spinner"}),n.jsxs("div",{className:"loading-text",children:[n.jsx("h4",{children:"Submitting Your Order"}),n.jsx("p",{children:"Please wait while we process your order..."})]})]})}),n.jsxs(e,{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"100vh"},children:[n.jsxs("div",{className:"checkout-card w-100",style:{minHeight:"60vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:[n.jsxs("div",{className:"checkout-header",children:[n.jsx("h2",{className:"checkout-title",children:"Order Summary"}),n.jsx("p",{className:"checkout-subtitle",children:"Please confirm your order details below before proceeding to payment"})]}),n.jsxs("div",{className:"checkout-content",children:[n.jsxs("div",{className:"summary-item",children:[n.jsxs("div",{className:"summary-item-content",children:[n.jsx("h4",{className:"summary-item-title",children:"Order Items Total"}),n.jsx("p",{className:"summary-item-subtitle",children:"Total amount of all items in your cart"})]}),n.jsx("div",{className:"summary-item-amount",children:c(P.toString())})]}),n.jsx("div",{className:"summary-divider"}),n.jsxs("div",{className:"summary-item",children:[n.jsxs("div",{className:"summary-item-content",children:[n.jsx("h4",{className:"summary-item-title",children:"Delivery Cost"}),n.jsx("p",{className:"summary-item-subtitle",children:`${(null==j?void 0:j.delivery_address_text)||"Delivery address"}, ${(null==j?void 0:j.delivery_address_details)||""}`})]}),n.jsx("div",{className:"summary-item-amount",children:c((null==j?void 0:j.delivery_amount)||"0")})]}),n.jsx("div",{className:"summary-divider-bold"}),n.jsxs("div",{className:"summary-item summary-total",children:[n.jsxs("div",{className:"summary-item-content",children:[n.jsx("h3",{className:"summary-total-title",children:"Total"}),n.jsx("p",{className:"summary-item-subtitle",children:"Final amount including all charges"})]}),n.jsx("div",{className:"summary-total-amount",children:c(Y.toString())})]}),z&&n.jsx(r,{variant:"danger",className:"checkout-error",children:z})]}),n.jsxs("div",{className:"checkout-actions",children:[n.jsx(o,{variant:"outline-secondary",onClick:()=>b("/delivery-address",{state:{order:j}}),className:"btn-back-checkout",disabled:S||N,children:"Back to Delivery Info"}),n.jsx(o,{onClick:()=>{C(!0)},disabled:S||N,className:"btn-submit-order",children:S||N?n.jsxs(n.Fragment,{children:[n.jsx(t,{size:"sm",className:"me-2"}),S?"Submitting Order...":"Loading..."]}):"Submit Order"})]})]}),n.jsxs(a,{show:I,onHide:()=>C(!1),centered:!0,children:[n.jsx(a.Header,{closeButton:!0,children:n.jsx(a.Title,{children:"Confirm Order Submission"})}),n.jsxs(a.Body,{children:[n.jsx("p",{children:"Are you sure you want to submit this order?"}),n.jsx("div",{className:"modal-order-summary",children:n.jsxs("strong",{children:["Total Amount: ",c(Y.toString())]})})]}),n.jsxs(a.Footer,{children:[n.jsx(o,{variant:"outline-secondary",onClick:()=>C(!1),disabled:S||N,children:"Cancel"}),n.jsx(o,{variant:"primary",onClick:()=>{return n=void 0,e=null,r=function*(){try{if(O(!0),_(!0),F(""),yield new Promise((n=>setTimeout(n,500))),!j||"object"!=typeof j)return F("Order information is invalid. Please restart the checkout process."),void b("/cart");if(!j.customer_name||!j.customer_phone_number_1)return void F("Order information is incomplete. Please go back and fill all required fields.");if(!v||0===v.length)return F("Your cart is empty. Please add items before checkout."),void b("/cart");const e=u.toJson(j);e.phone_number_2=j.customer_phone_number_2||j.customer_phone_number_1,e.phone_number_1=j.customer_phone_number_1,e.phone_number=e.phone_number_1;const r=yield l("orders-create",{items:JSON.stringify(v),delivery:JSON.stringify(e)});if(1!==r.code)return F(r.message||"Failed to submit order"),void m.error(`Failed ${r.message||"to submit order"}`);let t;try{t=r.data&&"function"==typeof s.fromJson?s.fromJson(r.data):u.ensureOrderModel(r.data)}catch(n){return F("Failed to process order response"),void m.error("Failed to process order response")}if(!t||t.id<1)return F(r.message||"Invalid order response"),void m.error("Failed to submit order");yield k(),m.success("Order submitted successfully!",{autoClose:4e3}),b(`/payment/${t.id}`,{state:{orderSuccess:!0,orderId:t.id,order:t,paymentUrl:u.getPaymentLink(t)}})}catch(n){F(n.message||"Failed to submit order"),m.error("Failed to submit order: "+(n.message||"Unknown error"))}finally{O(!1),_(!1),C(!1)}},new Promise(((t,o)=>{var a=n=>{try{s(r.next(n))}catch(e){o(e)}},i=n=>{try{s(r.throw(n))}catch(e){o(e)}},s=n=>n.done?t(n.value):Promise.resolve(n.value).then(a,i);s((r=r.apply(n,e)).next())}));var n,e,r},disabled:S||N,children:S||N?n.jsxs(n.Fragment,{children:[n.jsx(t,{size:"sm",className:"me-2"}),S?"Submitting...":"Loading..."]}):"Confirm Order"})]})]})]})]})]}):n.jsx(e,{className:"py-5",children:n.jsx(r,{variant:"warning",children:"Your cart is empty or order information is missing. Please start from the cart."})})};export{b as default};
