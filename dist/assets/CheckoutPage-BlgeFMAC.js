var X=Object.defineProperty;var M=(a,t,s)=>t in a?X(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var o=(a,t,s)=>M(a,typeof t!="symbol"?t+"":t,s);import{U as l,ai as R,I as W,J as Y,j as e,z as J,r as d,L as z,ag as q,K as D}from"./index-DqYG0ukg.js";const i=class i{constructor(){o(this,"id",0);o(this,"created_at","");o(this,"updated_at","");o(this,"address","");o(this,"latitude","");o(this,"longitude","");o(this,"shipping_cost","")}static fromJson(t){const s=new i;return t&&(s.id=l.int_parse(t.id),s.created_at=l.to_str(t.created_at,""),s.updated_at=l.to_str(t.updated_at,""),s.address=l.to_str(t.address,""),s.latitude=l.to_str(t.latitude,""),s.longitude=l.to_str(t.longitude,""),s.shipping_cost=l.to_str(t.shipping_cost,"")),s}toJson(){return{id:this.id,created_at:this.created_at,updated_at:this.updated_at,address:this.address,latitude:this.latitude,longitude:this.longitude,shipping_cost:this.shipping_cost}}static async getLocalData(t="1"){const s=[],c=l.loadFromDatabase(i.tableName);if(!c)return s;try{const m=JSON.parse(c);if(!Array.isArray(m))return s;m.forEach(g=>s.push(i.fromJson(g)))}catch(m){console.error("Failed to parse local data:",m)}return s}static async get_items(t="1"){let s=await i.getLocalData(t);return s.length===0?(await i.getOnlineItems(),s=await i.getLocalData(t)):i.getOnlineItems(),s}static async getOnlineItems(){const t=[];try{const s=await R(i.end_point,{});if(s.code!==1)return[];if(Array.isArray(s.data)){const c=s.data.map(m=>i.fromJson(m).toJson());l.saveToDatabase(i.tableName,JSON.stringify(c))}}catch(s){console.error("Error fetching online items:",s)}return t}async save(){let t=await i.getLocalData();const s=t.findIndex(c=>c.id===this.id);s!==-1?t[s]=this:t.push(this),l.saveToDatabase(i.tableName,JSON.stringify(t))}static async deleteAll(){l.saveToDatabase(i.tableName,JSON.stringify([]))}async delete(){let t=await i.getLocalData();t=t.filter(s=>s.id!==this.id),l.saveToDatabase(i.tableName,JSON.stringify(t))}};o(i,"end_point","delivery-addresses"),o(i,"tableName","delivery_addresses");let v=i;const $=({order:a})=>{const t=W(),{currentUser:s,clearCart:c,cartItems:m,totalCartAmount:g}=Y();if(!s)return e.jsxs(J.div,{className:"container py-5 text-center",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("h1",{style:{fontWeight:"bold"},children:"Please Log In"}),e.jsx("p",{className:"lead",children:"You must be logged in to checkout. Please log in or create an account."}),e.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>t("/login"),children:"Login"}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>t("/register"),children:"Create Account"})]})]});const[N,I]=d.useState([]),[b,L]=d.useState(null),[j,P]=d.useState(a.delivery_address_text||""),[x,_]=d.useState(a.delivery_address_details||""),[f,U]=d.useState(a.customer_name||""),[y,k]=d.useState(a.mail||""),[h,E]=d.useState(a.customer_phone_number_1||""),[S,F]=d.useState(a.order_details||""),[w,p]=d.useState(""),[C,A]=d.useState(!1);d.useEffect(()=>{(async()=>{try{const n=await v.get_items();I(n),n.length>0&&!b&&O(String(n[0].id))}catch(n){console.error("Failed to load delivery addresses:",n)}})()},[]);const O=r=>{const n=parseInt(r,10);L(n);const u=N.find(G=>G.id===n);u&&(P(u.address),_(u.address),a.delivery_amount=u.shipping_cost,a.delivery_address_text=u.address,a.delivery_address_details=u.address)},T=async()=>{if(!j||!x||!f||!y||!h){p("Please fill in all required fields.");return}if(!l.isValidMail(y)){p("Please enter a valid email address.");return}if(!h.startsWith("+")){p("Phone number should start with '+'.");return}if(!window.confirm("Are you sure you want to submit your order?"))return;p(""),A(!0);const r={...a.toJson(),delivery_address_text:j,delivery_address_details:x,mail:y,customer_name:f,customer_phone_number_1:h,order_details:S,customer_phone_number_2:a.customer_phone_number_2||h};try{const n=await z("orders-create",{items:JSON.stringify(m),delivery:JSON.stringify(r)}),u=q.fromJson(n);D.success("Order submitted successfully!",{autoClose:3e3}),c(),t("/admin/my-order")}catch(n){p(n.toString()),D.error(`Failed: ${n.toString()}`,{autoClose:3e3})}finally{A(!1)}};return e.jsxs(J.div,{className:"container py-5",initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"mb-5 text-center",children:[e.jsx("h1",{style:{fontWeight:"bold",color:"#114786"},children:"Checkout"}),e.jsx("p",{className:"text-muted",children:"Review your details and confirm your order."})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-7 mb-4",children:e.jsx("div",{className:"card shadow-sm border-0",children:e.jsxs("div",{className:"card-body p-4",children:[w&&e.jsx("div",{className:"alert alert-danger",children:w}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Delivery Address"}),e.jsxs("select",{className:"form-select",value:b?String(b):"",onChange:r=>O(r.target.value),children:[e.jsx("option",{value:"",children:"Select an address"}),N.map(r=>e.jsxs("option",{value:r.id,children:[r.address," (Shipping: UGX"," ",l.moneyFormat(r.shipping_cost),")"]},r.id))]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Street Address"}),e.jsx("input",{type:"text",className:"form-control",value:x,onChange:r=>_(r.target.value),placeholder:"Street, Province, Unit No."})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-control",value:f,onChange:r=>U(r.target.value),placeholder:"Your full name"})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email Address"}),e.jsx("input",{type:"email",className:"form-control",value:y,onChange:r=>k(r.target.value),placeholder:"Your email address"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Phone Number"}),e.jsx("input",{type:"text",className:"form-control",value:h,onChange:r=>E(r.target.value),placeholder:"Your phone number (include +)"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Order Details"}),e.jsx("textarea",{className:"form-control",value:S,onChange:r=>F(r.target.value),placeholder:"Additional instructions or details",rows:3})]})]})})}),e.jsx("div",{className:"col-md-5",children:e.jsx("div",{className:"card shadow-sm border-0",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h4",{style:{fontWeight:"bold",color:"#114786"},children:"Order Summary"}),e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("span",{children:"Items Total:"}),e.jsxs("span",{children:["UGX ",l.moneyFormat(g.toString())]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-3",children:[e.jsx("span",{children:"Delivery Cost:"}),e.jsx("span",{children:a.delivery_method.toLowerCase()==="pickup"?"UGX 0.00":"UGX "+l.moneyFormat(a.delivery_amount)})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold mb-3",style:{fontSize:"1.3rem"},children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["UGX"," ",l.moneyFormat((l.int_parse(a.payable_amount)+l.int_parse(a.getTax(g.toString()))).toString())]})]}),e.jsx("button",{className:"btn btn-lg w-100",style:{backgroundColor:"#114786",borderColor:"#114786",color:"#fff"},onClick:T,disabled:C,children:C?"Submitting...":"Submit Order"})]})})})]})]})};export{$ as default};
