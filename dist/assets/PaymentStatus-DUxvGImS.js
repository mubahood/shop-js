var e,a=Object.defineProperty,t=(e,a,t)=>new Promise(((s,n)=>{var i=e=>{try{c(t.next(e))}catch(a){n(a)}},r=e=>{try{c(t.throw(e))}catch(a){n(a)}},c=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,r);c((t=t.apply(e,a)).next())}));import{j as s,c as n,S as i,A as r,d as c,B as l}from"./vendor-bootstrap-D-I_tXzc.js";import{r as o}from"./vendor-react-BEzjZhyF.js";import{x as m,T as d,y as u}from"./index-UqLlkq5m.js";class y{static initializePayment(e){return t(this,null,(function*(){try{const a=yield m(`${this.BASE_PATH}/initialize`,e);if(1===a.code&&a.data)return d.info("Redirecting to payment gateway...",{autoClose:3e3}),{success:!0,data:a.data,message:a.message||"Payment initialized successfully"};{const e=a.message||"Failed to initialize payment";return d.paymentError(e),{success:!1,message:e}}}catch(a){const e=a.message||"Failed to initialize payment";return d.paymentError(e),{success:!1,message:e}}}))}static checkPaymentStatus(e){return t(this,null,(function*(){try{const a=yield u(`${this.BASE_PATH}/status/${e}`);return 1===a.code?{success:!0,data:a.data,message:a.message||"Payment status retrieved successfully"}:{success:!1,message:a.message||"Failed to check payment status"}}catch(a){return{success:!1,message:a.message||"Failed to check payment status"}}}))}static testConnectivity(){return t(this,null,(function*(){try{const e=yield m(`${this.BASE_PATH}/test`,{});return{success:1===e.code,message:e.message||"Connectivity test completed"}}catch(e){return{success:!1,message:e.message||"Failed to test connectivity"}}}))}static getPaymentGateways(){return t(this,null,(function*(){var e;try{const a=yield u(`${this.BASE_PATH}/config`);return 1===a.code&&(null==(e=a.data)?void 0:e.payment_gateways)?a.data.payment_gateways:[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}catch(a){return[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}}))}static handlePaymentCallback(e,a,t,s){t&&t({orderTrackingId:e,merchantReference:a})}static redirectToPayment(e){window.location.href=e}static openPaymentWindow(e,a=800,t=600){const s=window.screen.width/2-a/2,n=window.screen.height/2-t/2,i=window.open(e,"pesapal_payment",`width=${a},height=${t},left=${s},top=${n},resizable=yes,scrollbars=yes`);return i||(d.error("Popup blocked. Please allow popups and try again, or use direct payment."),this.redirectToPayment(e)),i}static createCallbackUrl(e){return`${window.location.origin}/payment/callback/${e}`}static formatAmount(e,a="UGX"){return new Intl.NumberFormat("en-UG",{style:"currency",currency:a,minimumFractionDigits:0}).format(e)}static getPaymentStatusColor(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"success";case"PENDING":case"IN_PROGRESS":return"warning";case"FAILED":case"INVALID":case"ERROR":return"danger";default:return"secondary"}}static getPaymentStatusIcon(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"bi-check-circle-fill";case"PENDING":case"IN_PROGRESS":return"bi-clock-fill";case"FAILED":case"INVALID":case"ERROR":return"bi-x-circle-fill";default:return"bi-question-circle-fill"}}}((e,t,s)=>{t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(y,"symbol"!=typeof(e="BASE_PATH")?e+"":e,"pesapal");const p=({orderId:e,trackingId:a,onStatusUpdate:m,autoRefresh:u=!1,refreshInterval:p=5e3,showActions:h=!0,className:g=""})=>{const[b,x]=o.useState("CHECKING"),[f,N]=o.useState(null),[v,w]=o.useState(!0),[P,j]=o.useState(""),[C,S]=o.useState(new Date);o.useEffect((()=>{E();let e=null;return u&&(e=setInterval((()=>{E(!1)}),p)),()=>{e&&clearInterval(e)}}),[e,u,p]);const E=(a=!0)=>t(void 0,null,(function*(){try{a&&w(!0),j("");const t=yield y.checkPaymentStatus(e);if(t.success&&t.data){const e=t.data.payment_status||"UNKNOWN";x(e),N(t.data),S(new Date),null==m||m(e,t.data),"COMPLETED"===e.toUpperCase()&&a&&d.paymentSuccess()}else{const e=t.message||"Failed to check payment status";j(e),a&&d.error(e)}}catch(t){const e=t.message||"Failed to check payment status";j(e),a&&d.error(e)}finally{a&&w(!1)}})),k=(()=>{switch(b.toUpperCase()){case"COMPLETED":case"SUCCESS":return{variant:"success",icon:"bi-check-circle-fill",title:"Payment Successful",message:"Your payment has been processed successfully."};case"PENDING":case"IN_PROGRESS":return{variant:"warning",icon:"bi-clock-fill",title:"Payment Pending",message:"Your payment is being processed. Please wait..."};case"FAILED":case"INVALID":case"ERROR":return{variant:"danger",icon:"bi-x-circle-fill",title:"Payment Failed",message:(null==f?void 0:f.payment_status_description)||"Payment processing failed. Please try again."};case"CHECKING":return{variant:"info",icon:"bi-arrow-clockwise",title:"Checking Status",message:"Verifying your payment status..."};default:return{variant:"secondary",icon:"bi-question-circle-fill",title:"Unknown Status",message:"Payment status is unclear. Please refresh or contact support."}}})();return v&&"CHECKING"===b?s.jsx(n,{className:`payment-status ${g}`,children:s.jsxs(n.Body,{className:"text-center py-4",children:[s.jsx(i,{animation:"border",variant:"primary"}),s.jsx("h5",{className:"mt-3",children:"Checking Payment Status"}),s.jsx("p",{className:"text-muted mb-0",children:"Please wait while we verify your payment..."})]})}):s.jsxs(n,{className:`payment-status border-${k.variant} ${g}`,children:[s.jsxs(n.Body,{children:[P&&s.jsxs(r,{variant:"danger",dismissible:!0,onClose:()=>j(""),className:"mb-3",children:[s.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),P]}),s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:`status-icon text-${k.variant} mb-3`,children:s.jsx("i",{className:`bi ${k.icon}`})}),s.jsx("h4",{className:"status-title",children:k.title}),s.jsx("p",{className:"status-message text-muted mb-3",children:k.message}),s.jsx(c,{bg:k.variant,className:"status-badge",children:b.toUpperCase()})]}),f&&s.jsx("div",{className:"payment-details mb-4",children:s.jsxs("div",{className:"details-grid",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("small",{className:"text-muted",children:"Order ID"}),s.jsxs("div",{className:"fw-semibold",children:["#",e]})]}),a&&s.jsxs("div",{className:"detail-item",children:[s.jsx("small",{className:"text-muted",children:"Tracking ID"}),s.jsx("div",{className:"fw-semibold",children:a})]}),f.amount&&s.jsxs("div",{className:"detail-item",children:[s.jsx("small",{className:"text-muted",children:"Amount"}),s.jsx("div",{className:"fw-semibold",children:y.formatAmount(parseFloat(f.amount),f.currency||"UGX")})]}),f.payment_method&&s.jsxs("div",{className:"detail-item",children:[s.jsx("small",{className:"text-muted",children:"Payment Method"}),s.jsx("div",{className:"fw-semibold",children:f.payment_method})]})]})}),s.jsx("div",{className:"last-checked text-center text-muted mb-3",children:s.jsxs("small",{children:[s.jsx("i",{className:"bi bi-clock me-1"}),"Last checked: ",C.toLocaleTimeString()]})}),h&&s.jsx("div",{className:"payment-actions",children:s.jsxs("div",{className:"d-grid gap-2",children:[s.jsx(l,{variant:"outline-primary",onClick:()=>E(!0),disabled:v,children:v?s.jsxs(s.Fragment,{children:[s.jsx(i,{animation:"border",size:"sm",className:"me-2"}),"Checking..."]}):s.jsxs(s.Fragment,{children:[s.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh Status"]})}),"FAILED"===b.toUpperCase()&&s.jsxs(l,{variant:"warning",onClick:()=>window.location.reload(),children:[s.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Try Payment Again"]}),"COMPLETED"===b.toUpperCase()&&s.jsxs(l,{variant:"success",onClick:()=>window.location.href="/account/orders",children:[s.jsx("i",{className:"bi bi-list-check me-2"}),"View Orders"]})]})})]}),s.jsx("style",{children:"\n        .payment-status .status-icon {\n          font-size: 3rem;\n          margin-bottom: 1rem;\n        }\n\n        .payment-status .status-title {\n          color: var(--bs-body-color);\n          margin-bottom: 0.5rem;\n        }\n\n        .payment-status .status-badge {\n          font-size: 0.9rem;\n          padding: 0.5rem 1rem;\n        }\n\n        .payment-status .payment-details {\n          background: var(--bs-light, #f8f9fa);\n          border-radius: 8px;\n          padding: 1rem;\n        }\n\n        .payment-status .details-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 1rem;\n        }\n\n        .payment-status .detail-item {\n          text-align: center;\n        }\n\n        .payment-status .detail-item small {\n          font-size: 0.75rem;\n          display: block;\n          margin-bottom: 0.25rem;\n        }\n\n        .payment-status .last-checked {\n          font-size: 0.8rem;\n          border-top: 1px solid var(--bs-border-color, #dee2e6);\n          padding-top: 0.75rem;\n        }\n\n        @media (max-width: 576px) {\n          .payment-status .details-grid {\n            grid-template-columns: 1fr 1fr;\n          }\n        }\n      "})]})};export{y as P,p as a};
