var t=Object.defineProperty,e=(e,i,a)=>((e,i,a)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[i]=a)(e,"symbol"!=typeof i?i+"":i,a),i=(t,e,i)=>new Promise(((a,s)=>{var r=t=>{try{n(i.next(t))}catch(e){s(e)}},o=t=>{try{n(i.throw(t))}catch(e){s(e)}},n=t=>t.done?a(t.value):Promise.resolve(t.value).then(r,o);n((i=i.apply(t,e)).next())}));import{T as a,A as s}from"./index-UqLlkq5m.js";import{U as r}from"./imageUtils-BKTQxf8T.js";import"./vendor-bootstrap-D-I_tXzc.js";import"./vendor-react-BEzjZhyF.js";import"./vendor-redux-Dj4qHuPE.js";class o{constructor(t){e(this,"id"),e(this,"title"),e(this,"subtitle"),e(this,"description"),e(this,"image"),e(this,"action_type"),e(this,"action_value"),e(this,"link"),e(this,"is_active"),e(this,"position"),e(this,"created_at"),e(this,"updated_at"),this.id=t.id,this.title=t.title,this.subtitle=t.subtitle,this.description=t.description,this.image=t.image,this.action_type=t.action_type,this.action_value=t.action_value,this.link=t.link,this.is_active=t.is_active,this.position=t.position,this.created_at=t.created_at,this.updated_at=t.updated_at}getImageUrl(){return r.img(this.image)}isActive(){return"Yes"===this.is_active}getActionUrl(){switch(this.action_type){case"category":return`/products?category=${this.action_value}`;case"product":return`/product/${this.action_value}`;case"vendor":return`/vendor/${this.action_value}`;case"url":return this.action_value||"#";default:return this.link||"#"}}static fromApiData(t){return new o({id:t.id,title:t.title||t.name||"Featured Banner",subtitle:t.subtitle,description:t.description,image:t.image||t.banner_image||t.photo,action_type:t.action_type,action_value:t.action_value,link:t.link,is_active:t.is_active||"Yes",position:t.position||0,created_at:t.created_at,updated_at:t.updated_at})}static sortByPosition(t){return[...t].sort(((t,e)=>(t.position||0)-(e.position||0)))}static filterActive(t){return t.filter((t=>t.isActive()))}}const n=class t{constructor(){e(this,"cachedManifest",null),e(this,"cacheExpiry",3e5),e(this,"lastCacheTime",0)}static getInstance(){return t.instance||(t.instance=new t),t.instance}loadHomepageManifest(t=!1){return i(this,null,(function*(){const e=Date.now();if(!t&&this.cachedManifest&&e-this.lastCacheTime<this.cacheExpiry)return this.cachedManifest;try{const t={banners:[],categories:[],topProducts:[],featuredCategories:[],isLoading:!0,lastUpdated:new Date},[i,a,s,r]=yield Promise.allSettled([this.loadBanners(),this.loadCategories(),this.loadVendors(),this.loadTopProducts()]);return"fulfilled"===i.status&&(t.banners=i.value),"fulfilled"===a.status&&(t.categories=a.value,t.featuredCategories=this.getFeaturedCategories(a.value)),"fulfilled"===r.status&&(t.topProducts=r.value),t.isLoading=!1,this.cachedManifest=t,this.lastCacheTime=e,t}catch(i){return a.error("Failed to load homepage data"),{banners:[],categories:[],topProducts:[],featuredCategories:[],isLoading:!1,lastUpdated:new Date}}}))}loadBanners(){return i(this,null,(function*(){try{const t=(yield s.getBannerCategories()).filter((t=>t.banner_image&&""!==t.banner_image.trim())).map(((t,e)=>o.fromApiData({id:t.id,title:t.category,subtitle:`Shop ${t.category}`,description:`Discover amazing ${t.category.toLowerCase()} products`,image:t.banner_image,action_type:"category",action_value:t.id.toString(),is_active:"Yes",position:e})));return 0===t.length?[]:o.sortByPosition(t)}catch(t){return[]}}))}createFallbackBanners(){return[{id:1,title:"Welcome to BlitXpress",subtitle:"Your one-stop shop",description:"Discover amazing products at unbeatable prices",image:"media/auth/bg1.jpg",action_type:"url",action_value:"/products",is_active:"Yes",position:1},{id:2,title:"Super Deals",subtitle:"Up to 50% Off",description:"Limited time offers on selected items",image:"media/auth/bg2.jpg",action_type:"url",action_value:"/products?sort_by=price_1",is_active:"Yes",position:2},{id:3,title:"New Arrivals",subtitle:"Fresh Products",description:"Check out our latest additions",image:"media/auth/bg3.jpg",action_type:"url",action_value:"/products?sort_by=date_added",is_active:"Yes",position:3}].map((t=>o.fromApiData(t)))}loadCategories(){return i(this,null,(function*(){return yield s.getCategories()}))}loadVendors(){return i(this,null,(function*(){return(yield s.getVendors()).slice(0,12)}))}loadTopProducts(){return i(this,null,(function*(){return(yield s.getProducts({page:1,limit:12,sort_by:"metric",sort_order:"desc",in_stock:!0})).data}))}getFeaturedCategories(t){return t.filter((t=>t.isShownInCategories())).slice(0,8)}clearCache(){this.cachedManifest=null,this.lastCacheTime=0}getCachedManifest(){const t=Date.now();return this.cachedManifest&&t-this.lastCacheTime<this.cacheExpiry?this.cachedManifest:null}};e(n,"instance");let c=n;const l=c.getInstance();export{c as ManifestService,l as default};
