var g=Object.defineProperty;var p=(n,e,i)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var a=(n,e,i)=>p(n,typeof e!="symbol"?e+"":e,i);import{T as h,A as l}from"./index-Ck1B39s_.js";import{U as m}from"./imageUtils-wi1HUAmV.js";class c{constructor(e){a(this,"id");a(this,"title");a(this,"subtitle");a(this,"description");a(this,"image");a(this,"action_type");a(this,"action_value");a(this,"link");a(this,"is_active");a(this,"position");a(this,"created_at");a(this,"updated_at");this.id=e.id,this.title=e.title,this.subtitle=e.subtitle,this.description=e.description,this.image=e.image,this.action_type=e.action_type,this.action_value=e.action_value,this.link=e.link,this.is_active=e.is_active,this.position=e.position,this.created_at=e.created_at,this.updated_at=e.updated_at}getImageUrl(){return m.img(this.image)}isActive(){return this.is_active==="Yes"}getActionUrl(){switch(this.action_type){case"category":return`/products?category=${this.action_value}`;case"product":return`/product/${this.action_value}`;case"vendor":return`/vendor/${this.action_value}`;case"url":return this.action_value||"#";default:return this.link||"#"}}static fromApiData(e){return new c({id:e.id,title:e.title||e.name||"Featured Banner",subtitle:e.subtitle,description:e.description,image:e.image||e.banner_image||e.photo,action_type:e.action_type,action_value:e.action_value,link:e.link,is_active:e.is_active||"Yes",position:e.position||0,created_at:e.created_at,updated_at:e.updated_at})}static sortByPosition(e){return[...e].sort((i,t)=>(i.position||0)-(t.position||0))}static filterActive(e){return e.filter(i=>i.isActive())}}const r=class r{constructor(){a(this,"cachedManifest",null);a(this,"cacheExpiry",5*60*1e3);a(this,"lastCacheTime",0)}static getInstance(){return r.instance||(r.instance=new r),r.instance}async loadHomepageManifest(e=!1){const i=Date.now();if(!e&&this.cachedManifest&&i-this.lastCacheTime<this.cacheExpiry)return this.cachedManifest;try{const t={banners:[],categories:[],topProducts:[],featuredCategories:[],isLoading:!0,lastUpdated:new Date},[o,s,_,u]=await Promise.allSettled([this.loadBanners(),this.loadCategories(),this.loadVendors(),this.loadTopProducts()]);return o.status==="fulfilled"?t.banners=o.value:console.warn("Failed to load banners:",o.reason),s.status==="fulfilled"?(t.categories=s.value,t.featuredCategories=this.getFeaturedCategories(s.value)):console.warn("Failed to load categories:",s.reason),u.status==="fulfilled"?t.topProducts=u.value:console.warn("Failed to load top products:",u.reason),t.isLoading=!1,this.cachedManifest=t,this.lastCacheTime=i,t}catch(t){return console.error("Failed to load homepage manifest:",t),h.error("Failed to load homepage data"),{banners:[],categories:[],topProducts:[],featuredCategories:[],isLoading:!1,lastUpdated:new Date}}}async loadBanners(){try{console.log("ðŸŽ  Loading banners from API...");const e=await l.getBannerCategories();console.log("ðŸŽ  Banner categories found:",e.length),console.log("ðŸŽ  Banner categories data:",e.map(t=>({id:t.id,name:t.category,show_in_banner:t.show_in_banner,banner_image:t.banner_image})));const i=e.filter(t=>{const o=t.banner_image&&t.banner_image.trim()!=="";return console.log(`ðŸŽ  Category "${t.category}" has banner image:`,o,t.banner_image),o}).map((t,o)=>{const s=c.fromApiData({id:t.id,title:t.category,subtitle:`Shop ${t.category}`,description:`Discover amazing ${t.category.toLowerCase()} products`,image:t.banner_image,action_type:"category",action_value:t.id.toString(),is_active:"Yes",position:o});return console.log(`ðŸŽ  Created banner for "${t.category}":`,s.getImageUrl()),s});return i.length===0?(console.log("ðŸŽ  No category banners found - returning empty array (no dummy data)"),[]):(console.log("ðŸŽ  Successfully created banners from categories:",i.length),c.sortByPosition(i))}catch(e){return console.error("ðŸŽ  Failed to load banners from categories:",e),[]}}createFallbackBanners(){const e=[{id:1,title:"Welcome to BlitXpress",subtitle:"Your one-stop shop",description:"Discover amazing products at unbeatable prices",image:"media/auth/bg1.jpg",action_type:"url",action_value:"/products",is_active:"Yes",position:1},{id:2,title:"Super Deals",subtitle:"Up to 50% Off",description:"Limited time offers on selected items",image:"media/auth/bg2.jpg",action_type:"url",action_value:"/products?sort_by=price_1",is_active:"Yes",position:2},{id:3,title:"New Arrivals",subtitle:"Fresh Products",description:"Check out our latest additions",image:"media/auth/bg3.jpg",action_type:"url",action_value:"/products?sort_by=date_added",is_active:"Yes",position:3}];return console.log("ðŸŽ  Created fallback banners:",e.length),e.map(i=>c.fromApiData(i))}async loadCategories(){return await l.getCategories()}async loadVendors(){return(await l.getVendors()).slice(0,12)}async loadTopProducts(){return(await l.getProducts({page:1,limit:12,sort_by:"metric",sort_order:"desc",in_stock:!0})).data}getFeaturedCategories(e){console.log("ðŸ“‚ Total categories received:",e.length);const i=e.filter(t=>{const o=t.isShownInCategories();return console.log(`ðŸ“‚ Category "${t.category}" shown in categories:`,o,t.show_in_categories),o}).slice(0,8);return console.log("ðŸ“‚ Featured categories found:",i.length),console.log("ðŸ“‚ Featured categories:",i.map(t=>t.category)),i}clearCache(){this.cachedManifest=null,this.lastCacheTime=0}getCachedManifest(){const e=Date.now();return this.cachedManifest&&e-this.lastCacheTime<this.cacheExpiry?this.cachedManifest:null}};a(r,"instance");let d=r;const v=d.getInstance();export{d as ManifestService,v as default};
