var $=Object.defineProperty;var q=(a,s,t)=>s in a?$(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var d=(a,s,t)=>q(a,typeof s!="symbol"?s+"":s,t);import{U as i,ai as z,I as K,J as V,r as l,j as e,z as D,M as g,p as I,L as W,ag as Y,K as E}from"./index-UmL11Jau.js";const n=class n{constructor(){d(this,"id",0);d(this,"created_at","");d(this,"updated_at","");d(this,"address","");d(this,"latitude","");d(this,"longitude","");d(this,"shipping_cost","")}static fromJson(s){const t=new n;return s&&(t.id=i.int_parse(s.id),t.created_at=i.to_str(s.created_at,""),t.updated_at=i.to_str(s.updated_at,""),t.address=i.to_str(s.address,""),t.latitude=i.to_str(s.latitude,""),t.longitude=i.to_str(s.longitude,""),t.shipping_cost=i.to_str(s.shipping_cost,"")),t}toJson(){return{id:this.id,created_at:this.created_at,updated_at:this.updated_at,address:this.address,latitude:this.latitude,longitude:this.longitude,shipping_cost:this.shipping_cost}}static async getLocalData(s="1"){const t=[],c=i.loadFromDatabase(n.tableName);if(!c)return t;try{const u=JSON.parse(c);if(!Array.isArray(u))return t;u.forEach(y=>t.push(n.fromJson(y)))}catch(u){console.error("Failed to parse local data:",u)}return t}static async get_items(s="1"){let t=await n.getLocalData(s);return t.length===0?(await n.getOnlineItems(),t=await n.getLocalData(s)):n.getOnlineItems(),t}static async getOnlineItems(){const s=[];try{const t=await z(n.end_point,{});if(t.code!==1)return[];if(Array.isArray(t.data)){const c=t.data.map(u=>n.fromJson(u).toJson());i.saveToDatabase(n.tableName,JSON.stringify(c))}}catch(t){console.error("Error fetching online items:",t)}return s}async save(){let s=await n.getLocalData();const t=s.findIndex(c=>c.id===this.id);t!==-1?s[t]=this:s.push(this),i.saveToDatabase(n.tableName,JSON.stringify(s))}static async deleteAll(){i.saveToDatabase(n.tableName,JSON.stringify([]))}async delete(){let s=await n.getLocalData();s=s.filter(t=>t.id!==this.id),i.saveToDatabase(n.tableName,JSON.stringify(s))}};d(n,"end_point","delivery-addresses"),d(n,"tableName","delivery_addresses");let N=n;const ee=({order:a})=>{const s=K(),{currentUser:t,clearCart:c,cartItems:u,totalCartAmount:y}=V(),[_,k]=l.useState([]),[f,F]=l.useState(null),[S,U]=l.useState(a.delivery_address_text||""),[v,w]=l.useState(a.delivery_address_details||""),[j,P]=l.useState(a.customer_name||""),[x,T]=l.useState(a.mail||""),[h,M]=l.useState(a.customer_phone_number_1||""),[C,G]=l.useState(a.order_details||""),[O,p]=l.useState(""),[A,J]=l.useState(!1),[X,b]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const o=await N.get_items();k(o),o.length>0&&!f&&L(String(o[0].id))}catch(o){console.error("Failed to load delivery addresses:",o)}})()},[f]);const L=r=>{const o=parseInt(r,10);F(o);const m=_.find(H=>H.id===o);m&&(U(m.address),w(m.address),a.delivery_amount=m.shipping_cost,a.delivery_address_text=m.address,a.delivery_address_details=m.address)},R=()=>{if(!S||!v||!j||!x||!h){p("All fields are required.");return}if(!i.isValidMail(x)){p("Enter a valid email address.");return}if(!h.startsWith("+")){p("Phone number should start with '+' sign.");return}b(!0)},B=async()=>{b(!1),p(""),J(!0);const r={...a.toJson(),delivery_address_text:S,delivery_address_details:v,mail:x,customer_name:j,customer_phone_number_1:h,order_details:C,customer_phone_number_2:a.customer_phone_number_2||h};try{const o=await W("orders-create",{items:JSON.stringify(u),delivery:JSON.stringify(r)}),m=Y.fromJson(o);E.success("Order placed successfully!"),c(),s("/admin/my-order")}catch(o){p(o.toString()),E.error(`Error: ${o.toString()}`)}finally{J(!1)}};return t?e.jsxs(D.div,{className:"container py-5",initial:{opacity:0},animate:{opacity:1},children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("h1",{className:"fw-bold",style:{color:"#114786"},children:"Checkout"}),e.jsx("p",{className:"text-muted",children:"Complete your details to place your order."})]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-7",children:e.jsxs("div",{className:"card border-0 shadow-sm p-4 rounded",children:[O&&e.jsx("div",{className:"alert alert-danger",children:O}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-bold",children:"Select Delivery Address"}),e.jsxs("select",{className:"form-select",value:f?String(f):"",onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"",children:"Choose an address"}),_.map(r=>e.jsxs("option",{value:r.id,children:[r.address," (Shipping: UGX"," ",i.moneyFormat(r.shipping_cost),")"]},r.id))]})]}),e.jsx("input",{type:"text",className:"form-control mb-3",placeholder:"Street, Apartment, Unit No.",value:v,onChange:r=>w(r.target.value)}),e.jsx("input",{type:"text",className:"form-control mb-3",placeholder:"Full Name",value:j,onChange:r=>P(r.target.value)}),e.jsx("input",{type:"email",className:"form-control mb-3",placeholder:"Email Address",value:x,onChange:r=>T(r.target.value)}),e.jsx("input",{type:"text",className:"form-control mb-3",placeholder:"Phone (+CountryCode)",value:h,onChange:r=>M(r.target.value)}),e.jsx("textarea",{className:"form-control mb-3",placeholder:"Order Notes (optional)",rows:3,value:C,onChange:r=>G(r.target.value)})]})}),e.jsx("div",{className:"col-md-5",children:e.jsxs("div",{className:"card border-0 shadow-sm p-4 rounded",children:[e.jsx("h4",{className:"fw-bold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["UGX ",i.moneyFormat(y.toString())]})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"Delivery:"}),e.jsx("span",{children:a.delivery_method.toLowerCase()==="pickup"?"UGX 0.00":`UGX ${i.moneyFormat(a.delivery_amount)}`})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between fw-bold fs-5",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["UGX"," ",i.moneyFormat((i.int_parse(a.payable_amount)+i.int_parse(a.getTax(y.toString()))).toString())]})]}),e.jsx("button",{className:"btn btn-primary btn-lg w-100 mt-4 shadow",onClick:R,disabled:A,children:A?"Processing...":"Place Order"})]})})]}),e.jsxs(g,{show:X,onHide:()=>b(!1),centered:!0,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:"Confirm Your Order"})}),e.jsx(g.Body,{children:"Are you sure you want to place this order?"}),e.jsxs(g.Footer,{children:[e.jsx(I,{variant:"secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsx(I,{variant:"primary",onClick:B,children:"Confirm"})]})]})]}):e.jsxs(D.div,{className:"container py-5 text-center",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("h1",{className:"fw-bold",children:"Please Log In"}),e.jsx("p",{className:"lead",children:"Log in or create an account to complete your purchase."}),e.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[e.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>s("/auth/login"),children:"Login"}),e.jsx("button",{className:"btn btn-outline-primary btn-lg",onClick:()=>s("/auth/register"),children:"Register"})]})]})};export{ee as default};
