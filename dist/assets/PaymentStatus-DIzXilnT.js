var e,a=Object.defineProperty,s=(e,a,s)=>new Promise(((t,n)=>{var i=e=>{try{c(s.next(e))}catch(a){n(a)}},r=e=>{try{c(s.throw(e))}catch(a){n(a)}},c=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,r);c((s=s.apply(e,a)).next())}));import{j as t,c as n,S as i,A as r,d as c,B as l}from"./vendor-bootstrap-DcTIMiez.js";import{r as m}from"./vendor-react-CSr-5IoM.js";import{v as o,T as d,w as u}from"./index-DTbjpcZ2.js";class y{static initializePayment(e){return s(this,null,(function*(){var a,s,t,n;try{const a=yield o(`${this.BASE_PATH}/initialize`,e);if(1===a.code&&a.data)return d.info("Redirecting to payment gateway...",{autoClose:3e3}),{success:!0,data:a.data,message:a.message||"Payment initialized successfully"};{const e=a.message||"Failed to initialize payment";return d.paymentError(e),{success:!1,message:e}}}catch(i){let e="Failed to initialize payment";return(null==(s=null==(a=i.response)?void 0:a.data)?void 0:s.message)?e=i.response.data.message:(null==(n=null==(t=i.response)?void 0:t.data)?void 0:n.error)?e=i.response.data.error:i.message&&!i.message.includes("status code")&&(e=i.message),d.paymentError(e),{success:!1,message:e}}}))}static checkPaymentStatus(e){return s(this,null,(function*(){try{const a=yield u(`${this.BASE_PATH}/status/${e}`);return 1===a.code?{success:!0,data:a.data,message:a.message||"Payment status retrieved successfully"}:{success:!1,message:a.message||"Failed to check payment status"}}catch(a){return{success:!1,message:a.message||"Failed to check payment status"}}}))}static testConnectivity(){return s(this,null,(function*(){try{const e=yield o(`${this.BASE_PATH}/test`,{});return{success:1===e.code,message:e.message||"Connectivity test completed"}}catch(e){return{success:!1,message:e.message||"Failed to test connectivity"}}}))}static getPaymentGateways(){return s(this,null,(function*(){var e;try{const a=yield u(`${this.BASE_PATH}/config`);return 1===a.code&&(null==(e=a.data)?void 0:e.payment_gateways)?a.data.payment_gateways:[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}catch(a){return[{id:"pesapal",name:"Pesapal",description:"Pay with Mobile Money, Credit Card, or Bank Transfer",enabled:!0,icon:"bi-credit-card"}]}}))}static handlePaymentCallback(e,a,s,t){s&&s({orderTrackingId:e,merchantReference:a})}static redirectToPayment(e){window.location.href=e}static openPaymentWindow(e,a=800,s=600){const t=window.screen.width/2-a/2,n=window.screen.height/2-s/2,i=window.open(e,"pesapal_payment",`width=${a},height=${s},left=${t},top=${n},resizable=yes,scrollbars=yes`);return i||(d.error("Popup blocked. Please allow popups and try again, or use direct payment."),this.redirectToPayment(e)),i}static createCallbackUrl(e){return`${window.location.origin}/payment/callback/${e}`}static formatAmount(e,a="UGX"){return new Intl.NumberFormat("en-UG",{style:"currency",currency:a,minimumFractionDigits:0}).format(e)}static getPaymentStatusColor(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"success";case"PENDING":case"IN_PROGRESS":return"warning";case"FAILED":case"INVALID":case"ERROR":return"danger";default:return"secondary"}}static getPaymentStatusIcon(e){switch(null==e?void 0:e.toUpperCase()){case"COMPLETED":case"SUCCESS":return"bi-check-circle-fill";case"PENDING":case"IN_PROGRESS":return"bi-clock-fill";case"FAILED":case"INVALID":case"ERROR":return"bi-x-circle-fill";default:return"bi-question-circle-fill"}}}((e,s,t)=>{s in e?a(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t})(y,"symbol"!=typeof(e="BASE_PATH")?e+"":e,"pesapal");const p=({orderId:e,trackingId:a,onStatusUpdate:o,showActions:u=!0,className:p=""})=>{const[h,g]=m.useState("CHECKING"),[b,x]=m.useState(null),[f,v]=m.useState(!0),[N,P]=m.useState(""),[w,j]=m.useState(new Date);m.useEffect((()=>{C()}),[e]);const C=(a=!0)=>s(void 0,null,(function*(){try{a&&v(!0),P("");const s=yield y.checkPaymentStatus(e);if(s.success&&s.data){const e=s.data.payment_status||"UNKNOWN";if(!0===s.data.is_paid||"confirmed"===s.data.order_state)return g("COMPLETED"),x(s.data),j(new Date),null==o||o("COMPLETED",s.data),void(a&&d.success("Payment already completed successfully!"));g(e),x(s.data),j(new Date),null==o||o(e,s.data),"COMPLETED"===e.toUpperCase()&&a&&d.paymentSuccess()}else{const e=s.message||"Failed to check payment status";P(e),a&&d.error(e)}}catch(s){const e=s.message||"Failed to check payment status";P(e),a&&d.error(e)}finally{a&&v(!1)}})),E=(()=>{switch(h.toUpperCase()){case"COMPLETED":case"SUCCESS":return{variant:"success",icon:"bi-check-circle-fill",title:"Payment Successful",message:"Your payment has been processed successfully."};case"PENDING":case"IN_PROGRESS":return{variant:"warning",icon:"bi-clock-fill",title:"Payment Pending",message:"Your payment is being processed. Please wait..."};case"FAILED":case"INVALID":case"ERROR":return{variant:"danger",icon:"bi-x-circle-fill",title:"Payment Failed",message:(null==b?void 0:b.payment_status_description)||"Payment processing failed. Please try again."};case"CHECKING":return{variant:"info",icon:"bi-arrow-clockwise",title:"Checking Status",message:"Verifying your payment status..."};default:return{variant:"secondary",icon:"bi-question-circle-fill",title:"Unknown Status",message:"Payment status is unclear. Please refresh or contact support."}}})();return f&&"CHECKING"===h?t.jsx(n,{className:`payment-status ${p}`,children:t.jsxs(n.Body,{className:"text-center py-4",children:[t.jsx(i,{animation:"border",variant:"primary"}),t.jsx("h5",{className:"mt-3",children:"Checking Payment Status"}),t.jsx("p",{className:"text-muted mb-0",children:"Please wait while we verify your payment..."})]})}):t.jsxs(n,{className:`payment-status border-${E.variant} ${p}`,children:[t.jsxs(n.Body,{children:[N&&t.jsxs(r,{variant:"danger",dismissible:!0,onClose:()=>P(""),className:"mb-3",children:[t.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),N]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:`status-icon text-${E.variant} mb-3`,children:t.jsx("i",{className:`bi ${E.icon}`})}),t.jsx("h4",{className:"status-title",children:E.title}),t.jsx("p",{className:"status-message text-muted mb-3",children:E.message}),t.jsx(c,{bg:E.variant,className:"status-badge",children:h.toUpperCase()})]}),b&&t.jsx("div",{className:"payment-details mb-4",children:t.jsxs("div",{className:"details-grid",children:[t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Order ID"}),t.jsxs("div",{className:"fw-semibold",children:["#",e]})]}),a&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Tracking ID"}),t.jsx("div",{className:"fw-semibold",children:a})]}),b.amount&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Amount"}),t.jsx("div",{className:"fw-semibold",children:y.formatAmount(parseFloat(b.amount),b.currency||"UGX")})]}),b.payment_method&&t.jsxs("div",{className:"detail-item",children:[t.jsx("small",{className:"text-muted",children:"Payment Method"}),t.jsx("div",{className:"fw-semibold",children:b.payment_method})]})]})}),t.jsx("div",{className:"text-center mb-3",children:t.jsxs("div",{className:"alert alert-info py-2 mb-0",children:[t.jsx("i",{className:"bi bi-info-circle me-2"}),t.jsx("small",{children:'Payment status is checked manually. Click "Check Payment Status" below to refresh.'})]})}),t.jsx("div",{className:"last-checked text-center text-muted mb-3",children:t.jsxs("small",{children:[t.jsx("i",{className:"bi bi-clock me-1"}),"Last checked: ",w.toLocaleTimeString()]})}),u&&t.jsx("div",{className:"payment-actions",children:t.jsxs("div",{className:"d-grid gap-2",children:[t.jsx(l,{variant:"primary",size:"lg",onClick:()=>C(!0),disabled:f,children:f?t.jsxs(t.Fragment,{children:[t.jsx(i,{animation:"border",size:"sm",className:"me-2"}),"Checking Payment Status..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Check Payment Status"]})}),"FAILED"===h.toUpperCase()&&t.jsxs(l,{variant:"warning",onClick:()=>window.location.reload(),children:[t.jsx("i",{className:"bi bi-arrow-repeat me-2"}),"Try Payment Again"]}),"COMPLETED"===h.toUpperCase()&&t.jsxs(l,{variant:"success",onClick:()=>window.location.href="/account/orders",children:[t.jsx("i",{className:"bi bi-list-check me-2"}),"View Orders"]})]})})]}),t.jsx("style",{children:"\n        .payment-status .status-icon {\n          font-size: 3rem;\n          margin-bottom: 1rem;\n        }\n\n        .payment-status .status-title {\n          color: var(--bs-body-color);\n          margin-bottom: 0.5rem;\n        }\n\n        .payment-status .status-badge {\n          font-size: 0.9rem;\n          padding: 0.5rem 1rem;\n        }\n\n        .payment-status .payment-details {\n          background: var(--bs-light, #f8f9fa);\n          border-radius: 8px;\n          padding: 1rem;\n        }\n\n        .payment-status .details-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n          gap: 1rem;\n        }\n\n        .payment-status .detail-item {\n          text-align: center;\n        }\n\n        .payment-status .detail-item small {\n          font-size: 0.75rem;\n          display: block;\n          margin-bottom: 0.25rem;\n        }\n\n        .payment-status .last-checked {\n          font-size: 0.8rem;\n          border-top: 1px solid var(--bs-border-color, #dee2e6);\n          padding-top: 0.75rem;\n        }\n\n        @media (max-width: 576px) {\n          .payment-status .details-grid {\n            grid-template-columns: 1fr 1fr;\n          }\n        }\n      "})]})};export{y as P,p as a};
